extends ../layout

block content
  br
  h4 #{user.displayName} の日記
  each diary in diaries
    div(class='row')
      div(class='col s12 m12')
        div(class='card blue lighten-5')
          div(class='card-content')
            p(class='card-title')
              h5
               a(href= '/diaries/' + diary.diaryId )= moment(diary.createdAt).format('[[]YYYY-MM-DD HH:mm[]]')
               span 
               span!= diary.sanitizedTitle
            p(style="white-space:pre-wrap;")!= diary.sanitizedBody
            div(class='right-align')
              a(href='https://twitter.com/share' class='twitter-share-button', data-url= config.MY_SITE_ROOT + 'diaries/' + diary.diaryId, data-text= diary.sanitizedTitle.slice(0,25) , data-hashtags= config.TWITTER_HASHTAG)
              script= "!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');"
          div(class='card-action')
            if diary.isMine
              a(href='/diaries/' + diary.diaryId + '/edit', class='waves-effect waves-light btn blue darken-2') 編集
            if isDeleteExecutor
              br
              br
              form(method='post', action='/diaries/' + diary.diaryId + '/delete')
                input(type='hidden', name='diaryId', value= diary.diaryId)
                button(type='submit', class='waves-effect waves-light btn red darken-2') 削除人として削除する
            div(class='left-align')
            - var fromDiaryIds = mapFromDiaryIds.get(diary.diaryId)
            - fromDiaryIds = fromDiaryIds ? fromDiaryIds : [];
            h6= 'トラックバック一覧 (' + fromDiaryIds.length + ')'
            ul
              each fromDiaryId in fromDiaryIds
                li
                  a(href= '/diaries/' + fromDiaryId )= '/diaries/' + fromDiaryId
  br
